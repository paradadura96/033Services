<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>033Services üöóüèÅ</title>
<style>
body { font-family: Arial, sans-serif; background:#111; color:#fff; padding:15px;}
h2 { color:#B23EFF; text-align:center; margin-bottom:20px; }
.box { background:#222; padding:20px; border-radius:12px; margin-bottom:15px;}
input, button { width:100%; padding:12px; margin:8px 0; border-radius:8px; border:none; font-size:16px; }
input { background:#1E1E2E; color:#fff; }
button { background:#B23EFF; color:#fff; font-weight:bold; cursor:pointer; transition:0.3s; }
button:hover { background:#9B1DE5; }
label { display:block; margin-top:10px; font-size:16px; cursor:pointer; }
#result { margin-top:15px; white-space: pre-line; font-size:16px; background:#1a1a2e; padding:10px; border-radius:8px; }
</style>
</head>
<body>

<h2>033Services üöóüèÅ</h2>

<div class="box">
    <input type="text" id="partenza" placeholder="Endere√ßo de partida">
    <input type="text" id="arrivo" placeholder="Endere√ßo de destino">
    <input type="text" id="telefone" placeholder="Telefone do cliente">
</div>

<div class="box">
    <label><input type="checkbox" id="urgente"> Corrida urgente (+1‚Ç¨)</label>
    <label><input type="checkbox" id="bagagem" onclick="document.getElementById('qntMalas').style.display=this.checked?'block':'none'"> Tem bagagem?</label>
    <input type="number" id="qntMalas" placeholder="Quantidade de malas" min="1" style="display:none">
    <label><input type="checkbox" id="agendado" onclick="document.getElementById('horario').style.display=this.checked?'block':'none'"> Agendar corrida (+1‚Ç¨)</label>
    <input type="datetime-local" id="horario" style="display:none">
</div>

<button id="calcBtn">Calcular Corrida</button>
<div id="result"></div>
<button id="confirmButton" style="display:none;">‚úÖ Confirmar e enviar</button>

<script>
// Substitua com sua chave API
const GOOGLE_MAPS_KEY = "SUA_CHAVE_AQUI";
const BOT_TOKEN = "SEU_BOT_TOKEN";
const CHAT_ID = "SEU_CHAT_ID";

// Carregar Google Maps API dinamicamente
function loadGoogleMaps(callback){
    if(typeof google==='object' && typeof google.maps==='object'){
        callback();
    } else {
        const script = document.createElement('script');
        script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_KEY}`;
        script.onload = callback;
        document.head.appendChild(script);
    }
}

let lastRide = null;

function calcularCorrida(){
    loadGoogleMaps(() => {
        const start = document.getElementById('partenza').value.trim();
        const end = document.getElementById('arrivo').value.trim();
        const phone = document.getElementById('telefone').value.trim();
        const urgent = document.getElementById('urgente').checked;
        const bag = document.getElementById('bagagem').checked;
        const qntBag = parseInt(document.getElementById('qntMalas').value) || 0;
        const agendado = document.getElementById('agendado').checked;
        const horario = document.getElementById('horario').value;

        if(!start || !end || !phone){ alert("Preencha partida, destino e telefone!"); return; }

        const service = new google.maps.DistanceMatrixService();
        service.getDistanceMatrix({
            origins:[start + ", Torino, Italia"],
            destinations:[end + ", Torino, Italia"],
            travelMode:'DRIVING'
        }, (response, status)=>{
            if(status!=="OK"){ alert("Erro ao calcular dist√¢ncia: "+status); return; }
            const elem = response.rows[0].elements[0];
            if(elem.status!=="OK"){ alert("Endere√ßo inv√°lido ou fora de Torino!"); return; }

            const km = elem.distance.value/1000;
            let price = 5 + km*1.75;
            let extras = "";

            if(urgent){ price+=1; extras+="‚Ä¢ Corrida urgente +1‚Ç¨\n"; }
            if(bag && qntBag>3){ let extraBag = Math.ceil((qntBag-3)/2)*2; price+=extraBag; extras+=`‚Ä¢ Bagagem (${qntBag} malas) +${extraBag}‚Ç¨\n`; }
            if(agendado && horario){ price+=1; extras+="‚Ä¢ Agendamento +1‚Ç¨\n"; }

            price = price.toFixed(2);

            document.getElementById('result').innerText = 
                `Dist√¢ncia: ${km.toFixed(2)} km\nPre√ßo total: ${price} ‚Ç¨\nExtras:\n${extras||'Nenhum'}`;
            document.getElementById('confirmButton').style.display='block';

            lastRide = {start,end,phone,km:km.toFixed(2),price,extras,horario:agendado?horario:'N√£o agendado',urgent:urgent?'Sim':'N√£o',qntBag};
        });
    });
}

function enviarTelegram(){
    if(!lastRide) return;
    const text = `üöó Nova Corrida!\nPonto de partida: ${lastRide.start}\nDestino: ${lastRide.end}\nTelefone: ${lastRide.phone}\nDist√¢ncia: ${lastRide.km} km\nPre√ßo: ${lastRide.price} ‚Ç¨\nBagagens: ${lastRide.qntBag}\nHor√°rio: ${lastRide.horario}\nCorrida urgente: ${lastRide.urgent}\nExtras:\n${lastRide.extras}`;
    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({chat_id:CHAT_ID,text:text})
    }).then(()=>alert("Corrida enviada com sucesso!"));

    // Reset
    document.getElementById('confirmButton').style.display='none';
    document.getElementById('partenza').value='';
    document.getElementById('arrivo').value='';
    document.getElementById('telefone').value='';
    document.getElementById('bagagem').checked=false;
    document.getElementById('qntMalas').value=''; document.getElementById('qntMalas').style.display='none';
    document.getElementById('agendado').checked=false;
    document.getElementById('horario').value=''; document.getElementById('horario').style.display='none';
    document.getElementById('urgente').checked=false;
    document.getElementById('result').innerText='';
    lastRide=null;
}

// Associar bot√µes
document.getElementById('calcBtn').addEventListener('click', calcularCorrida);
document.getElementById('confirmButton').addEventListener('click', enviarTelegram);
</script>

</body>
</html>
