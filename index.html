<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>033 Services - Calcolo Corsa</title>
<style>
    body { font-family: Arial; padding: 20px; background: #111; color: #fff; }
    input, button, select { padding: 8px; width: 100%; margin-top: 10px; }
    .box { background: #222; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
    button { background: #e60000; color: #fff; border: none; cursor: pointer; font-size: 18px; }
</style>

<script>
async function calcolaCorsa() {
    const partenza = document.getElementById("partenza").value;
    const arrivo = document.getElementById("arrivo").value;
    const telefono = document.getElementById("telefono").value;

    const urgente = document.getElementById("urgente").checked;
    const bagagem = document.getElementById("bagagem").checked;
    const qntMalas = parseInt(document.getElementById("qntMalas").value || 0);

    const agendado = document.getElementById("agendado").checked;
    const horario = document.getElementById("horario").value;

    if (!partenza || !arrivo || !telefono) {
        alert("Preencha os campos obrigatÃ³rios!");
        return;
    }

    let apiKey = "SUA_CHAVE_AQUI";

    let url = `https://maps.googleapis.com/maps/api/distancematrix/json?origins=${encodeURIComponent(partenza)}&destinations=${encodeURIComponent(arrivo)}&key=${apiKey}`;

    const response = await fetch(url);
    const data = await response.json();

    if (!data.rows[0].elements[0].distance) {
        alert("Erro ao calcular distÃ¢ncia.");
        return;
    }

    const km = data.rows[0].elements[0].distance.value / 1000;

    let preco = km * 1.75;
    let extras = "";

    if (urgente) { preco += 1; extras += "â€¢ Urgente +1â‚¬\n"; }

    if (bagagem && qntMalas > 3) {
        const adicionais = Math.floor((qntMalas - 3) / 2) * 2;
        preco += adicionais;
        extras += `â€¢ Bagagem extra (${qntMalas} malas) +${adicionais}â‚¬\n`;
    }

    if (agendado && horario) { preco += 1; extras += "â€¢ Agendado +1â‚¬\n"; }

    preco = preco.toFixed(2);

    document.getElementById("result").innerHTML = `
        <b>Distanza:</b> ${km.toFixed(2)} km<br>
        <b>Prezzo totale:</b> â‚¬${preco}<br>
        <b>Extras:</b><br>${extras || "Nessuno"}
    `;

    document.getElementById("confirmButton").style.display = "block";

    window.preparedMessage =
       `ğŸš• *NOVA CORSA* ğŸš•\n\n` +
       `ğŸ“ Partenza: ${partenza}\n` +
       `ğŸ Arrivo: ${arrivo}\n` +
       `ğŸ“ Telefone: ${telefono}\n` +
       `ğŸ“ Distanza: ${km.toFixed(2)} km\n` +
       `ğŸ’¶ Prezzo: â‚¬${preco}\n` +
       `${agendado ? "ğŸ•’ Agendada: " + horario + "\n" : ""}` +
       `${extras ? "\nExtras:\n" + extras : ""}`;
}

async function enviarTelegram() {
    const BOT_TOKEN = "SEU_BOT_TOKEN";
    const CHAT_ID = "SEU_CHAT_ID";

    if (!window.preparedMessage) {
        alert("Calcola prima la corsa.");
        return;
    }

    const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;

    await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: CHAT_ID, text: window.preparedMessage, parse_mode: "Markdown" })
    });

    alert("Corsa inviata âœ…");
}
</script>
</head>
<body>

<h2>033 Services - Calcolo Corsa</h2>

<div class="box">
    <label>ğŸ“ Partenza</label>
    <input type="text" id="partenza" placeholder="Indirizzo di partenza">
    
    <label>ğŸ Destinazione</label>
    <input type="text" id="arrivo" placeholder="Indirizzo di arrivo">

    <label>ğŸ“ Telefono</label>
    <input type="text" id="telefono" placeholder="Numero cliente">
</div>

<div class="box">
    <label><input type="checkbox" id="urgente"> ğŸ”¥ Urgente (+1â‚¬)</label><br>
    
    <label><input type="checkbox" id="bagagem" onchange="document.getElementById('qntMalas').style.display = this.checked ? 'block' : 'none'"> ğŸ§³ Bagagem</label>
    <input type="number" id="qntMalas" placeholder="Quantidade de malas" style="display:none">

    <label><input type="checkbox" id="agendado" onchange="document.getElementById('horario').style.display = this.checked ? 'block' : 'none'"> â° Agendar corrida (+1â‚¬)</label>
    <input type="datetime-local" id="horario" style="display:none">
</div>

<button onclick="calcolaCorsa()">Calcolare corsa</button>

<div id="result" style="margin-top:15px;"></div>

<button id="confirmButton" style="display:none; margin-top:20px;" onclick="enviarTelegram()">âœ… Confermare e inviare</button>

</body>
</html>
